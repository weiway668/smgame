<!--pages/maze/maze.wxml-->
<!-- è¿·å®«æ¸¸æˆé¡µé¢ -->

<view class="container">
  <!-- ç´§å‡‘å‹æ¸¸æˆå¤´éƒ¨ -->
  <view class="game-header-compact">
    <view class="back-btn-compact" bindtap="backToHome">
      <text>â†</text>
    </view>
    <text class="game-title-compact">èµ°è¿·å®«</text>
    <picker 
      mode="selector"
      range="{{difficulties}}"
      range-key="label"
      value="{{difficulty === 'easy' ? 0 : difficulty === 'medium' ? 1 : 2}}"
      bindchange="changeDifficulty"
    >
      <view class="difficulty-selector-compact">
        <text>{{difficulties[difficulty === 'easy' ? 0 : difficulty === 'medium' ? 1 : 2].label}}</text>
        <text class="arrow">â–¼</text>
      </view>
    </picker>
  </view>

  <!-- æ¸¸æˆç”»å¸ƒ -->
  <view class="game-canvas-wrapper">
    <canvas 
      type="2d"
      id="mazeCanvas"
      class="game-canvas"
      style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
      bindtouchstart="touchStart"
      bindtouchend="touchEnd"
    ></canvas>
    
    <!-- æ‚¬æµ®ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="floating-stats">
      <view class="floating-stat-item left">
        <text class="stat-icon">ğŸ‘£</text>
        <text class="stat-value">{{steps}}</text>
      </view>
      <view class="floating-stat-item right">
        <text class="stat-icon">â±</text>
        <text class="stat-value">{{time}}s</text>
      </view>
    </view>
    
    <!-- æ¸¸æˆçŠ¶æ€è¦†ç›–å±‚ -->
    <view class="game-overlay" wx:if="{{gameStatus === 'ready'}}">
      <view class="overlay-content">
        <text class="overlay-title">å‡†å¤‡å¼€å§‹</text>
        <text class="overlay-desc">æ»‘åŠ¨æˆ–ä½¿ç”¨æ–¹å‘é”®ç§»åŠ¨</text>
        <button class="btn-start" bindtap="startGame">å¼€å§‹æ¸¸æˆ</button>
      </view>
    </view>
    
    <view class="game-overlay" wx:if="{{gameStatus === 'paused'}}">
      <view class="overlay-content">
        <text class="overlay-title">æ¸¸æˆæš‚åœ</text>
        <button class="btn-resume" bindtap="resumeGame">ç»§ç»­æ¸¸æˆ</button>
        <button class="btn-restart" bindtap="restartGame">é‡æ–°å¼€å§‹</button>
      </view>
    </view>
  </view>

  <!-- æ§åˆ¶é¢æ¿ -->
  <view class="control-panel">
    <!-- æ–¹å‘æ§åˆ¶å™¨ï¼ˆå¢å¤§é—´è·ï¼‰ -->
    <view class="direction-controller">
      <view class="direction-row">
        <view class="direction-spacer"></view>
        <view 
          class="direction-btn up"
          data-direction="up"
          bindtap="onDirectionTap"
          hover-class="direction-btn-hover"
          hover-stay-time="50"
        >
          <text>â†‘</text>
        </view>
        <view class="direction-spacer"></view>
      </view>
      <view class="direction-row middle">
        <view 
          class="direction-btn left"
          data-direction="left"
          bindtap="onDirectionTap"
          hover-class="direction-btn-hover"
          hover-stay-time="50"
        >
          <text>â†</text>
        </view>
        <view class="direction-center">
          <view class="center-dot"></view>
        </view>
        <view 
          class="direction-btn right"
          data-direction="right"
          bindtap="onDirectionTap"
          hover-class="direction-btn-hover"
          hover-stay-time="50"
        >
          <text>â†’</text>
        </view>
      </view>
      <view class="direction-row">
        <view class="direction-spacer"></view>
        <view 
          class="direction-btn down"
          data-direction="down"
          bindtap="onDirectionTap"
          hover-class="direction-btn-hover"
          hover-stay-time="50"
        >
          <text>â†“</text>
        </view>
        <view class="direction-spacer"></view>
      </view>
    </view>

    <!-- å›¾æ ‡åŒ–æ“ä½œæŒ‰é’® -->
    <view class="action-buttons">
      <button 
        class="action-btn icon-btn {{gameStatus === 'playing' ? '' : 'disabled'}}"
        bindtap="{{gameStatus === 'playing' ? 'pauseGame' : ''}}"
        disabled="{{gameStatus !== 'playing'}}"
      >
        <text class="btn-icon">{{gameStatus === 'playing' ? 'â¸' : 'â–¶'}}</text>
        <text class="btn-tooltip">{{gameStatus === 'playing' ? 'æš‚åœ' : 'å¼€å§‹'}}</text>
      </button>
      <button 
        class="action-btn icon-btn"
        bindtap="restartGame"
      >
        <text class="btn-icon">â†»</text>
        <text class="btn-tooltip">é‡ç©</text>
      </button>
      <button 
        class="action-btn icon-btn {{showHint ? 'active' : ''}}"
        bindtap="toggleHint"
      >
        <text class="btn-icon">ğŸ’¡</text>
        <text class="btn-tooltip">{{showHint ? 'éšè—' : 'æç¤º'}}</text>
      </button>
    </view>
  </view>
</view>
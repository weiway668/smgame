<!--pages/maze/maze.wxml-->
<!-- 迷宫游戏页面 -->

<view class="container">
  <!-- 紧凑型游戏头部 -->
  <view class="game-header-compact">

    <picker 
      mode="selector"
      range="{{difficulties}}"
      range-key="label"
      value="{{difficulty === 'easy' ? 0 : difficulty === 'medium' ? 1 : 2}}"
      bindchange="changeDifficulty"
    >
      <view class="difficulty-selector-compact">
        <text>{{difficulties[difficulty === 'easy' ? 0 : difficulty === 'medium' ? 1 : 2].label}}</text>
        <text class="arrow">▼</text>
      </view>
    </picker>
  </view>

  <!-- 游戏画布 -->
  <view class="game-canvas-wrapper">
    <!-- Canvas容器，确保相对定位 -->
    <view class="canvas-container" style="position: relative; width: {{canvasWidth}}px; height: {{canvasHeight}}px;">
      <canvas 
        type="2d"
        id="mazeCanvas"
        class="game-canvas"
        style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
      ></canvas>
      
      <!-- 透明覆盖层处理所有交互，确保完全覆盖Canvas -->
      <view 
        class="touch-layer"
        style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
        bindtap="handleTap"
        bindtouchstart="touchStart"
        bindtouchend="touchEnd"
      ></view>
    </view>
    
    <!-- 悬浮统计信息 -->
    <view class="floating-stats">
      <view class="floating-stat-item left">
        <text class="stat-icon">👣</text>
        <text class="stat-value">{{steps}}</text>
      </view>
      <view class="floating-stat-item right">
        <text class="stat-icon">⏱</text>
        <text class="stat-value">{{time}}s</text>
      </view>
    </view>
    
    <!-- 游戏状态覆盖层 -->
    <view class="game-overlay" wx:if="{{gameStatus === 'ready'}}">
      <view class="overlay-content">
        <text class="overlay-title">准备开始</text>
        <text class="overlay-desc">滑动或使用方向键移动</text>
        <button class="btn-start" bindtap="startGame">开始游戏</button>
      </view>
    </view>
    
    <view class="game-overlay" wx:if="{{gameStatus === 'paused'}}">
      <view class="overlay-content">
        <text class="overlay-title">游戏暂停</text>
        <button class="btn-resume" bindtap="resumeGame">继续游戏</button>
        <button class="btn-restart" bindtap="restartGame">重新开始</button>
      </view>
    </view>
  </view>

  <!-- 控制面板 -->
  <view class="control-panel">


    <!-- 图标化操作按钮 -->
    <view class="action-buttons">
      <button 
        class="action-btn icon-btn {{gameStatus === 'playing' ? '' : 'disabled'}}"
        bindtap="{{gameStatus === 'playing' ? 'pauseGame' : ''}}"
        disabled="{{gameStatus !== 'playing'}}"
      >
        <text class="btn-icon">{{gameStatus === 'playing' ? '⏸' : '▶'}}</text>
        <text class="btn-tooltip">{{gameStatus === 'playing' ? '暂停' : '开始'}}</text>
      </button>
      <button 
        class="action-btn icon-btn"
        bindtap="restartGame"
      >
        <text class="btn-icon">↻</text>
        <text class="btn-tooltip">重玩</text>
      </button>

    </view>
  </view>
</view>
<!--pages/maze/maze.wxml-->
<!-- 迷宫游戏页面 -->

<view class="container">
  <!-- 游戏头部 -->
  <view class="game-header">
    <view class="header-left">
      <view class="back-btn" bindtap="backToHome">
        <text>←</text>
      </view>
    </view>
    <view class="header-center">
      <text class="game-title">走迷宫</text>
    </view>
    <view class="header-right">
      <picker 
        mode="selector"
        range="{{difficulties}}"
        range-key="label"
        value="{{difficulty === 'easy' ? 0 : difficulty === 'medium' ? 1 : 2}}"
        bindchange="changeDifficulty"
      >
        <view class="difficulty-selector">
          <text>{{difficulties[difficulty === 'easy' ? 0 : difficulty === 'medium' ? 1 : 2].label}}</text>
          <text class="arrow">▼</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- 游戏统计 -->
  <view class="game-stats">
    <view class="stat-item">
      <text class="stat-label">步数</text>
      <text class="stat-value">{{steps}}</text>
      <text class="stat-best" wx:if="{{bestSteps}}">最佳: {{bestSteps}}</text>
    </view>
    <view class="stat-item">
      <text class="stat-label">时间</text>
      <text class="stat-value">{{time}}秒</text>
      <text class="stat-best" wx:if="{{bestTime}}">最佳: {{bestTime}}秒</text>
    </view>
  </view>

  <!-- 游戏画布 -->
  <view class="game-canvas-wrapper">
    <canvas 
      type="2d"
      id="mazeCanvas"
      class="game-canvas"
      style="width: {{canvasWidth}}px; height: {{canvasHeight}}px;"
      bindtouchstart="touchStart"
      bindtouchend="touchEnd"
    ></canvas>
    
    <!-- 游戏状态覆盖层 -->
    <view class="game-overlay" wx:if="{{gameStatus === 'ready'}}">
      <view class="overlay-content">
        <text class="overlay-title">准备开始</text>
        <text class="overlay-desc">滑动或使用方向键移动</text>
        <button class="btn-start" bindtap="startGame">开始游戏</button>
      </view>
    </view>
    
    <view class="game-overlay" wx:if="{{gameStatus === 'paused'}}">
      <view class="overlay-content">
        <text class="overlay-title">游戏暂停</text>
        <button class="btn-resume" bindtap="resumeGame">继续游戏</button>
        <button class="btn-restart" bindtap="restartGame">重新开始</button>
      </view>
    </view>
  </view>

  <!-- 控制面板 -->
  <view class="control-panel">
    <!-- 方向控制器 -->
    <view class="direction-controller">
      <view class="direction-row">
        <view 
          class="direction-btn up"
          data-direction="up"
          bindtap="onDirectionTap"
        >
          <text>↑</text>
        </view>
      </view>
      <view class="direction-row">
        <view 
          class="direction-btn left"
          data-direction="left"
          bindtap="onDirectionTap"
        >
          <text>←</text>
        </view>
        <view class="direction-center"></view>
        <view 
          class="direction-btn right"
          data-direction="right"
          bindtap="onDirectionTap"
        >
          <text>→</text>
        </view>
      </view>
      <view class="direction-row">
        <view 
          class="direction-btn down"
          data-direction="down"
          bindtap="onDirectionTap"
        >
          <text>↓</text>
        </view>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="action-buttons">
      <button 
        class="action-btn {{gameStatus === 'playing' ? '' : 'disabled'}}"
        bindtap="{{gameStatus === 'playing' ? 'pauseGame' : ''}}"
        disabled="{{gameStatus !== 'playing'}}"
      >
        <text>{{gameStatus === 'playing' ? '暂停' : '未开始'}}</text>
      </button>
      <button 
        class="action-btn"
        bindtap="restartGame"
      >
        <text>重玩</text>
      </button>
      <button 
        class="action-btn {{showHint ? 'active' : ''}}"
        bindtap="toggleHint"
      >
        <text>{{showHint ? '隐藏' : '提示'}}</text>
      </button>
    </view>
  </view>
</view>